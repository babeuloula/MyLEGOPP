/* Copyright 2014 My Lego Profil Pic. All rights reserved. */jQuery(function ($) {    window.onbeforeunload = function() {        $.ajax({            url: "clear.php",            async: false,            success: function(response) {}        });    };    $(document).on('click', '.step1 .facebook a', function (e) {        e.preventDefault();        $('.logo').css('padding-top', '15px');        $('.logo img').width(255).height(180);        $('.step1').fadeOut(250, function () {            $('.step2 p').html("Téléchargement de l'image en cours ...");            $('.step2').fadeIn(250, function () {                window.setTimeout(function () {                    $('.step4 p').html("Traitement de l'image en cours ...");                    window.setTimeout(function () {                        $('.step4').fadeOut(250, function () {                            $('.step5').fadeIn(250);                        });                    }, 3000);                }, 3000);            });        });    });    $(document).on('click', '.step1 .autre a', function (e) {        e.preventDefault();        $(".step1 .notif").fadeOut(250);        $("#autreImage").click();    });    $(document).on('click', '.home', function (e) {        $(this).removeClass('home');        $('.logo').css('padding-top', '15%');        $('.logo img').width(338).height(220);        $(".crop img").attr("src", '');        $("#formCrop input").val('');        $("#autreImage").val('');        $('.step2, .step3, .step5').fadeOut(250, function () {            $('.step1').fadeIn(250);        });    });    $("#autreImage").change(function() {        var ext = $(this).val().split('.').pop();        if($.trim($(this).val()) != '') {            if(ext.toLowerCase() != "gif" && ext.toLowerCase() != "png" && ext.toLowerCase() != "jpg" && ext.toLowerCase() != "jpeg") {                $(".step1 .notif").fadeIn(250).html('Veuillez sélectionner une image');            } else {                $(".step1 .notif").hide();                $('.logo').css('padding-top', '15px');                $('.logo img').addClass('home').width(255).height(180);                $('.step1').fadeOut(250, function () {                    $('.step2 p').html("Téléchargement de l'image en cours ...");                    $('.step2').fadeIn(250, function () {                        $(".step1 .autre").upload("upload/", function(data) {                            $("#autreImage").val('');                            var json = $.parseJSON(data);                            if(json.width < 600 || json.height < 600) {                                $('.logo').css('padding-top', '15%');                                $('.logo img').width(338).height(220);                                $('.step2').fadeOut(250, function () {                                    $('.step1').fadeIn(250, function() {                                        $(".step1 .notif").fadeIn(250).html('Veuillez sélectionner une image d\'au moins 600px de largeur et hauteur');                                    });                                });                            } else if(json.width > 600 && json.height > 600) {                                $(".crop img").attr("src", json.lego);                                var api = $.Jcrop('.crop img');                                api.setImage(json.lego, function() {                                    api.setOptions({                                        aspectRatio: 600 / 600,                                        bgColor: 'black',                                        bgOpacity: .4,                                        keySupport: false,                                        onSelect: updateCoords,                                        onChange: updateCoords,                                        setSelect: [0, 0, 600, 600]                                    });                                });                                $('.step2').fadeOut(250, function () {                                    $('.step3').fadeIn(250, function () {                                        api.focus();                                        $(document).on('click', '#rogner', function() {                                            if(checkCoords()) {                                                $('.step3').fadeOut(250, function () {                                                    $('.step4 p').html("Traitement de l'image en cours ...");                                                    $('.step4').fadeIn(250, function () {                                                        $.ajax({                                                            url: "crop.php",                                                            type: 'post',                                                            data: $(".step3 #formCrop").serialize(),                                                            success: function(response) {                                                                api.destroy();                                                                var json = $.parseJSON(response);                                                                $('.step5 .affichage img').attr('src', json.lego);                                                                $('.step5 .partage .facebook').attr('data-url', json.share).attr('data-title', 'Partager sur Facebook');                                                                $('.step5 .partage .twitter').attr('data-url', json.share).attr('data-title', 'Partager sur Twitter');                                                                $('.step5 .partage .facebook').sharrre({                                                                    share: { facebook: true },                                                                    url: json.share,                                                                    enableHover: false,                                                                    enableTracking: false,                                                                    lang: 'fr_FR',                                                                    click: function(api, options){                                                                        api.simulateClick();                                                                        api.openPopup('facebook');                                                                    }                                                                });                                                                $('.step5 .partage .twitter').sharrre({                                                                    share: { twitter: true },                                                                    url: json.share,                                                                    enableHover: false,                                                                    enableTracking: false,                                                                    lang: 'fr',                                                                    buttons: { twitter: {hashtags: 'MyLEGOProfilPic'}},                                                                    click: function(api, options){                                                                        api.simulateClick();                                                                        api.openPopup('twitter');                                                                    }                                                                });                                                                $('.step4').fadeOut(250, function () {                                                                    $('.step5').fadeIn(250);                                                                    $(document).on('click', '.step5 .partage .download', function() {                                                                        $(location).attr('href',"download/" + json.folder + '/');                                                                    });                                                                });                                                            }                                                        });                                                    });                                                });                                            }                                        });                                    });                                });                            } else if(json.width == 600 && json.height == 600) {                                $('.step4 p').html("Traitement de l'image en cours ...");                                $.ajax({                                    url: "render.php",                                    success: function(response) {                                        var json = $.parseJSON(response);                                        $('.step5 .affichage img').attr('src', json.lego);                                        $('.step5 .partage .facebook').attr('data-url', json.share).attr('data-title', 'Partager sur Facebook');                                        $('.step5 .partage .twitter').attr('data-url', json.share).attr('data-title', 'Partager sur Twitter');                                        $('.step5 .partage .facebook').sharrre({                                            share: { facebook: true },                                            url: json.share,                                            enableHover: false,                                            enableTracking: false,                                            lang: 'fr_FR',                                            click: function(api, options){                                                api.simulateClick();                                                api.openPopup('facebook');                                            }                                        });                                        $('.step5 .partage .twitter').sharrre({                                            share: { twitter: true },                                            url: json.share,                                            enableHover: false,                                            enableTracking: false,                                            lang: 'fr',                                            buttons: { twitter: {hashtags: 'MyLEGOProfilPic'}},                                            click: function(api, options){                                                api.simulateClick();                                                api.openPopup('twitter');                                            }                                        });                                        $('.step4').fadeOut(250, function () {                                            $('.step5').fadeIn(250);                                            $(document).on('click', '.step5 .partage .download', function() {                                                $(location).attr('href',"download/" + json.folder + '/');                                            });                                        });                                    }                                });                            }                        });                    });                });            }        }    });});